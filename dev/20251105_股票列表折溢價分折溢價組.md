# 股票列表折溢價分折溢價組
- 以下方指標，采集以下分組數據
  - HSI 最大放量股數據
  - 侍定

``` javascript
//@version=6
indicator("股票列表折溢價分折溢價組")

// 輸入
inpCode = input.float(3.141592654, "CRAWLER-CODE")
symbol_list_str = input.text_area("HKEX:5,HKEX:939,HKEX:1299,HKEX:388,HKEX:1398,HKEX:2318,HKEX:3988,HKEX:3968,HKEX:2628,HKEX:2388", "編碼")
timezone_str = input.string("Asia/Hong_Kong", '時區', ["Asia/Hong_Kong", "Asia/Tokyo", "Europe/London", "Europe/Paris", "America/New_York"], inline='timezone')
// desc =input.string( '顯示名稱','顯示')
roc_size = input.int(5, 'ROC長度')
refresh = input.bool(false, 'refresh')

// 時間計算
dd = dayofmonth(time, timezone_str), hh = hour(time, timezone_str), mm = minute(time, timezone_str)

// 數據調用
symbol_list = str.split(symbol_list_str, ',')
roc_list = array.new_float(array.size(symbol_list), 0)
na_cnt = 0
to_sum = 0.
for [i, symbol] in symbol_list
    [turnover, roc] = request.security(ticker.modify(symbol, session = session.extended, adjustment = adjustment.dividends), timeframe.period, [close * volume, ta.roc(close, roc_size)], gaps = barmerge.gaps_on)
    to_sum += nz(turnover)
    array.set(roc_list, i, roc)
    if na(roc)
        na_cnt += 1

roc_min = array.min(roc_list)
roc_max = array.max(roc_list)
roc_min_max_diff = roc_max - roc_min
roc_range_max_diff = ta.highest(roc_min_max_diff, 120)
roc_min_max_diff_rate = roc_min_max_diff / roc_range_max_diff


section_size = math.floor((array.size(roc_list) - na_cnt) / 3)

// 每分鐘折溢價計算
prem_list = array.new_string()
midd_list = array.new_string()
disc_list = array.new_string()

roc_list_asc = array.sort_indices(array.copy(roc_list), order.ascending)
roc_list_des = array.sort_indices(array.copy(roc_list), order.descending)


if array.size(roc_list_asc) > 0
    for i = 0 to array.size(roc_list_asc) - 1 by 1
        _idx = array.get(roc_list_asc, i)
        sym = array.get(symbol_list, _idx)
        roc = array.get(roc_list, _idx)
        if not na(roc)
            if array.size(disc_list) <= section_size
                array.push(disc_list, sym)

if array.size(roc_list_des) > 0
    for i = 0 to array.size(roc_list_des) - 1 by 1
        _idx = array.get(roc_list_des, i)
        sym = array.get(symbol_list, _idx)
        roc = array.get(roc_list, _idx)
        if not na(roc)
            if array.size(prem_list) <= section_size
                array.push(prem_list, sym)

for i = 0 to array.size(roc_list) - 1 by 1
    sym = array.get(symbol_list, i)
    roc = array.get(roc_list, i)
    is_prem_list_exists = array.includes(prem_list, sym)
    is_disc_list_exists = array.includes(disc_list, sym)
    if not na(roc) and not is_prem_list_exists and not is_disc_list_exists
        array.push(midd_list, sym)




// 采集用-拼接數據
crawler_0_9_prem_disc_list = array.new_int(10, 0)
crawler_10_19_prem_disc_list = array.new_int(10, 0)
crawler_20_29_prem_disc_list = array.new_int(10, 0)
crawler_30_39_prem_disc_list = array.new_int(10, 0)
for i = 0 to array.size(roc_list) - 1 by 1
    sym = array.get(symbol_list, i)
    roc = array.get(roc_list, i)
    is_prem_list_exists = array.includes(prem_list, sym)
    is_disc_list_exists = array.includes(disc_list, sym)
    is_midd_list_exists = array.includes(midd_list, sym)

    if i >=0 and i <= 9
        if is_prem_list_exists
            array.set(crawler_0_9_prem_disc_list, i, 1)
        else if is_disc_list_exists
            array.set(crawler_0_9_prem_disc_list, i, 2)
        else if is_midd_list_exists
            array.set(crawler_0_9_prem_disc_list, i, 3)
    if i >=10 and i <= 19
        if is_prem_list_exists
            array.set(crawler_10_19_prem_disc_list, i - 10, 1)
        else if is_disc_list_exists
            array.set(crawler_10_19_prem_disc_list, i - 10, 2)
        else if is_midd_list_exists
            array.set(crawler_10_19_prem_disc_list, i - 10, 3)
    if i >=20 and i <= 29
        if is_prem_list_exists
            array.set(crawler_20_29_prem_disc_list, i - 20, 1)
        else if is_disc_list_exists
            array.set(crawler_20_29_prem_disc_list, i - 20, 2)
        else if is_midd_list_exists
            array.set(crawler_20_29_prem_disc_list, i - 20, 3)
    if i >=30 and i <= 39
        if is_prem_list_exists
            array.set(crawler_30_39_prem_disc_list, i - 30, 1)
        else if is_disc_list_exists
            array.set(crawler_30_39_prem_disc_list, i - 30, 2)
        else if is_midd_list_exists
            array.set(crawler_30_39_prem_disc_list, i - 30, 3)
    
crawler_0_9_prem_disc_v =  str.tonumber(str.format('9{0}', array.join(crawler_0_9_prem_disc_list, '')))
crawler_10_19_prem_disc_v =  str.tonumber(str.format('9{0}', array.join(crawler_10_19_prem_disc_list, '')))
crawler_20_29_prem_disc_v =  str.tonumber(str.format('9{0}', array.join(crawler_20_29_prem_disc_list, '')))
crawler_30_39_prem_disc_v =  str.tonumber(str.format('9{0}', array.join(crawler_30_39_prem_disc_list, '')))

if mm % roc_size != 0
    crawler_0_9_prem_disc_v := 0
    crawler_10_19_prem_disc_v := 0
    crawler_20_29_prem_disc_v := 0
    crawler_30_39_prem_disc_v := 0


plotchar(inpCode, 'code', '', location.bottom)
plotchar(0, 'open', '', location.bottom)
plotchar(0, 'high', '', location.bottom, display=display.none)
plotchar(0, 'low', '', location.bottom, display=display.none)
plotchar(0, 'close', '', location.bottom, display=display.none)
plotchar(crawler_0_9_prem_disc_v, 'volume', '', location.bottom, display=display.none)
plotchar(crawler_10_19_prem_disc_v, 'turnover', '', location.bottom, display=display.none)
plotchar(time, 'time', '', location.bottom)
plotchar(time_close, 'time_close', '', location.bottom, display=display.none)
plotchar(crawler_20_29_prem_disc_v, 'volume_discharge', '', location.bottom, display=display.none)
plotchar(crawler_30_39_prem_disc_v, 'premium', '', location.bottom, display=display.none)
plotchar(0, 'bid_size', '', location.bottom, display=display.none)
plotchar(0, 'ask_size', '', location.bottom, display=display.none)


```
